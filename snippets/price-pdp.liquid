
<div class="pdp-main-price">
  <h2><span class="price-vat-done" data-price="{{ product.price }}">{{ product.price | money }}</span> <span class="vat-line"></span> </h2>
  <svg class="tax-pop-trig" xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15" role="img" aria-label="Tool Tip" class="vat-info__icon"><path d="M7.5,0A7.5,7.5,0,1,0,15,7.5,7.5,7.5,0,0,0,7.5,0Zm0,14A6.5,6.5,0,1,1,14,7.5,6.5,6.5,0,0,1,7.5,14Z"></path> <path d="M6.8,8.9c0-.8.6-1.3,1.2-1.9a2.6,2.6,0,0,0,.9-1.8A1.3,1.3,0,0,0,7.4,3.7a1.9,1.9,0,0,0-1.6.9L5,3.9A3,3,0,0,1,7.5,2.7,2.4,2.4,0,0,1,10,5.1,3.2,3.2,0,0,1,8.8,7.4c-.6.6-1.1,1-1.1,1.5v.6H6.8Zm-.2,2.7a.7.7,0,1,1,.7.7A.7.7,0,0,1,6.5,11.6Z"></path></svg>

  <div class="tax-info">
    <p>VAT (Value Added Tax) is a UK tax on products that is not applicable to clients outside of the UK. If you are a VAT registered business based outside of the UK in the EU you will also be exempt from the UK tax.</p>
   <div class="tax-info__btns">
    <div class="btn js-remove-vat in-uk" data-remove="false">
      Remove VAT
    </div>

    <div class="btn-primary js-open-country-modal">
      Change country
    </div>

   </div>
   

  </div>
</div>





<div class="country-modal">
  <div class="country-modal__inner">
    <button type="button" aria-label="Close" class="btn-close"></button>
    <h3>Please confirm your Location</h3>

    <div class="select">
      <select id="location" aria-label="Select your location" required="required">
        <option selected="selected" disabled="disabled">Please select...</option> 
        <option value="AF">Afghanistan</option>
        <option value="AX">
            Åland Islands
        </option><option value="AL">
            Albania
        </option><option value="DZ">
            Algeria
        </option><option value="AS">
            American Samoa
        </option><option value="AD">
            Andorra
        </option><option value="AO">
            Angola
        </option><option value="AI">
            Anguilla
        </option><option value="AQ">
            Antarctica
        </option><option value="AG">
            Antigua &amp; Barbuda
        </option><option value="AR">
            Argentina
        </option><option value="AM">
            Armenia
        </option><option value="AW">
            Aruba
        </option><option value="AU">
            Australia
        </option><option value="AT">
            Austria
        </option><option value="AZ">
            Azerbaijan
        </option><option value="BS">
            Bahamas
        </option><option value="BH">
            Bahrain
        </option><option value="BD">
            Bangladesh
        </option><option value="BB">
            Barbados
        </option><option value="BY">
            Belarus
        </option><option value="BE">
            Belgium
        </option><option value="BZ">
            Belize
        </option><option value="BJ">
            Benin
        </option><option value="BM">
            Bermuda
        </option><option value="BT">
            Bhutan
        </option><option value="BO">
            Bolivia
        </option><option value="BA">
            Bosnia &amp; Herzegovina
        </option><option value="BW">
            Botswana
        </option><option value="BV">
            Bouvet Island
        </option><option value="BR">
            Brazil
        </option><option value="IO">
            British Indian Ocean Territory
        </option><option value="VG">
            British Virgin Islands
        </option><option value="BN">
            Brunei
        </option><option value="BG">
            Bulgaria
        </option><option value="BF">
            Burkina Faso
        </option><option value="BI">
            Burundi
        </option><option value="KH">
            Cambodia
        </option><option value="CM">
            Cameroon
        </option><option value="CA">
            Canada
        </option><option value="CV">
            Cape Verde
        </option><option value="BQ">
            Caribbean Netherlands
        </option><option value="KY">
            Cayman Islands
        </option><option value="CF">
            Central African Republic
        </option><option value="TD">
            Chad
        </option><option value="CL">
            Chile
        </option><option value="CN">
            China
        </option><option value="CX">
            Christmas Island
        </option><option value="CC">
            Cocos (Keeling) Islands
        </option><option value="CO">
            Colombia
        </option><option value="KM">
            Comoros
        </option><option value="CG">
            Congo - Brazzaville
        </option><option value="CD">
            Congo - Kinshasa
        </option><option value="CK">
            Cook Islands
        </option><option value="CR">
            Costa Rica
        </option><option value="CI">
            Côte d’Ivoire
        </option><option value="HR">
            Croatia
        </option><option value="CU">
            Cuba
        </option><option value="CW">
            Curaçao
        </option><option value="CY">
            Cyprus
        </option><option value="CZ">
            Czechia
        </option><option value="DK">
            Denmark
        </option><option value="DJ">
            Djibouti
        </option><option value="DM">
            Dominica
        </option><option value="DO">
            Dominican Republic
        </option><option value="EC">
            Ecuador
        </option><option value="EG">
            Egypt
        </option><option value="SV">
            El Salvador
        </option><option value="GQ">
            Equatorial Guinea
        </option><option value="ER">
            Eritrea
        </option><option value="EE">
            Estonia
        </option><option value="SZ">
            Eswatini
        </option><option value="ET">
            Ethiopia
        </option><option value="FK">
            Falkland Islands
        </option><option value="FO">
            Faroe Islands
        </option><option value="FJ">
            Fiji
        </option><option value="FI">
            Finland
        </option><option value="FR">
            France
        </option><option value="GF">
            French Guiana
        </option><option value="PF">
            French Polynesia
        </option><option value="TF">
            French Southern Territories
        </option><option value="GA">
            Gabon
        </option><option value="GM">
            Gambia
        </option><option value="GE">
            Georgia
        </option><option value="DE">
            Germany
        </option><option value="GH">
            Ghana
        </option><option value="GI">
            Gibraltar
        </option><option value="GR">
            Greece
        </option><option value="GL">
            Greenland
        </option><option value="GD">
            Grenada
        </option><option value="GP">
            Guadeloupe
        </option><option value="GU">
            Guam
        </option><option value="GT">
            Guatemala
        </option><option value="GG">
            Guernsey
        </option><option value="GN">
            Guinea
        </option><option value="GW">
            Guinea-Bissau
        </option><option value="GY">
            Guyana
        </option><option value="HT">
            Haiti
        </option><option value="HM">
            Heard &amp; McDonald Islands
        </option><option value="HN">
            Honduras
        </option><option value="HK">
            Hong Kong SAR China
        </option><option value="HU">
            Hungary
        </option><option value="IS">
            Iceland
        </option><option value="IN">
            India
        </option><option value="ID">
            Indonesia
        </option><option value="IR">
            Iran
        </option><option value="IQ">
            Iraq
        </option><option value="IE">
            Ireland
        </option><option value="IM">
            Isle of Man
        </option><option value="IL">
            Israel
        </option><option value="IT">
            Italy
        </option><option value="JM">
            Jamaica
        </option><option value="JP">
            Japan
        </option><option value="JE">
            Jersey
        </option><option value="JO">
            Jordan
        </option><option value="KZ">
            Kazakhstan
        </option><option value="KE">
            Kenya
        </option><option value="KI">
            Kiribati
        </option><option value="KW">
            Kuwait
        </option><option value="KG">
            Kyrgyzstan
        </option><option value="LA">
            Laos
        </option><option value="LV">
            Latvia
        </option><option value="LB">
            Lebanon
        </option><option value="LS">
            Lesotho
        </option><option value="LR">
            Liberia
        </option><option value="LY">
            Libya
        </option><option value="LI">
            Liechtenstein
        </option><option value="LT">
            Lithuania
        </option><option value="LU">
            Luxembourg
        </option><option value="MO">
            Macao SAR China
        </option><option value="MG">
            Madagascar
        </option><option value="MW">
            Malawi
        </option><option value="MY">
            Malaysia
        </option><option value="MV">
            Maldives
        </option><option value="ML">
            Mali
        </option><option value="MT">
            Malta
        </option><option value="MH">
            Marshall Islands
        </option><option value="MQ">
            Martinique
        </option><option value="MR">
            Mauritania
        </option><option value="MU">
            Mauritius
        </option><option value="YT">
            Mayotte
        </option><option value="MX">
            Mexico
        </option><option value="FM">
            Micronesia
        </option><option value="MD">
            Moldova
        </option><option value="MC">
            Monaco
        </option><option value="MN">
            Mongolia
        </option><option value="ME">
            Montenegro
        </option><option value="MS">
            Montserrat
        </option><option value="MA">
            Morocco
        </option><option value="MZ">
            Mozambique
        </option><option value="MM">
            Myanmar (Burma)
        </option><option value="NA">
            Namibia
        </option><option value="NR">
            Nauru
        </option><option value="NP">
            Nepal
        </option><option value="NL">
            Netherlands
        </option><option value="NC">
            New Caledonia
        </option><option value="NZ">
            New Zealand
        </option><option value="NI">
            Nicaragua
        </option><option value="NE">
            Niger
        </option><option value="NG">
            Nigeria
        </option><option value="NU">
            Niue
        </option><option value="NF">
            Norfolk Island
        </option><option value="KP">
            North Korea
        </option><option value="MK">
            North Macedonia
        </option><option value="MP">
            Northern Mariana Islands
        </option><option value="NO">
            Norway
        </option><option value="OM">
            Oman
        </option><option value="PK">
            Pakistan
        </option><option value="PW">
            Palau
        </option><option value="PS">
            Palestinian Territories
        </option><option value="PA">
            Panama
        </option><option value="PG">
            Papua New Guinea
        </option><option value="PY">
            Paraguay
        </option><option value="PE">
            Peru
        </option><option value="PH">
            Philippines
        </option><option value="PN">
            Pitcairn Islands
        </option><option value="PL">
            Poland
        </option><option value="PT">
            Portugal
        </option><option value="PR">
            Puerto Rico
        </option><option value="QA">
            Qatar
        </option><option value="RE">
            Réunion
        </option><option value="RO">
            Romania
        </option><option value="RU">
            Russia
        </option><option value="RW">
            Rwanda
        </option><option value="WS">
            Samoa
        </option><option value="SM">
            San Marino
        </option><option value="ST">
            São Tomé &amp; Príncipe
        </option><option value="SA">
            Saudi Arabia
        </option><option value="SN">
            Senegal
        </option><option value="RS">
            Serbia
        </option><option value="SC">
            Seychelles
        </option><option value="SL">
            Sierra Leone
        </option><option value="SG">
            Singapore
        </option><option value="SX">
            Sint Maarten
        </option><option value="SK">
            Slovakia
        </option><option value="SI">
            Slovenia
        </option><option value="SB">
            Solomon Islands
        </option><option value="SO">
            Somalia
        </option><option value="ZA">
            South Africa
        </option><option value="GS">
            South Georgia &amp; South Sandwich Islands
        </option><option value="KR">
            South Korea
        </option><option value="SS">
            South Sudan
        </option><option value="ES">
            Spain
        </option><option value="LK">
            Sri Lanka
        </option><option value="BL">
            St. Barthélemy
        </option><option value="SH">
            St. Helena
        </option><option value="KN">
            St. Kitts &amp; Nevis
        </option><option value="LC">
            St. Lucia
        </option><option value="MF">
            St. Martin
        </option><option value="PM">
            St. Pierre &amp; Miquelon
        </option><option value="VC">
            St. Vincent &amp; Grenadines
        </option><option value="SD">
            Sudan
        </option><option value="SR">
            Suriname
        </option><option value="SJ">
            Svalbard &amp; Jan Mayen
        </option><option value="SE">
            Sweden
        </option><option value="CH">
            Switzerland
        </option><option value="SY">
            Syria
        </option><option value="TW">
            Taiwan
        </option><option value="TJ">
            Tajikistan
        </option><option value="TZ">
            Tanzania
        </option><option value="TH">
            Thailand
        </option><option value="TL">
            Timor-Leste
        </option><option value="TG">
            Togo
        </option><option value="TK">
            Tokelau
        </option><option value="TO">
            Tonga
        </option><option value="TT">
            Trinidad &amp; Tobago
        </option><option value="TN">
            Tunisia
        </option><option value="TR">
            Turkey
        </option><option value="TM">
            Turkmenistan
        </option><option value="TC">
            Turks &amp; Caicos Islands
        </option><option value="TV">
            Tuvalu
        </option><option value="UM">
            U.S. Outlying Islands
        </option><option value="VI">
            U.S. Virgin Islands
        </option><option value="UG">
            Uganda
        </option><option value="UA">
            Ukraine
        </option><option value="AE">
            United Arab Emirates
        </option><option value="GB">
            United Kingdom
        </option><option value="US">
            United States
        </option><option value="UY">
            Uruguay
        </option><option value="UZ">
            Uzbekistan
        </option><option value="VU">
            Vanuatu
        </option><option value="VA">
            Vatican City
        </option><option value="VE">
            Venezuela
        </option><option value="VN">
            Vietnam
        </option><option value="WF">
            Wallis &amp; Futuna
        </option><option value="EH">
            Western Sahara
        </option><option value="YE">
            Yemen
        </option><option value="ZM">
            Zambia
        </option><option value="ZW">
            Zimbabwe
        </option>
      </select>
    </div>

    <div class="btn js-select-country">
      <span>Set my location</span>
    </div>
    </div>
  </div>
</div>




<script>
  // 'check'
  // let ip = '185.35.50.4'
  let ip = 'check'
  let access_key = 'd705cb90e5162b90e3cd2f1fdb422b9a';
  let url = 'https://api.ipstack.com/' + ip + '?access_key=' + access_key
  const select = document.querySelector('#location')

    //open modal
  const countryButton = document.querySelector('.js-open-country-modal')
  const modalCountry = document.querySelector('.country-modal')
  const closeButtonCountry = document.querySelector('.country-modal .btn-close')
  const taxPopup = document.querySelector('.tax-info')
  const popupTrigger = document.querySelector('.tax-pop-trig')
  const removeVatBtn = document.querySelector('.js-remove-vat')



  function showVAT(){
    const prices = document.querySelectorAll('.price-vat-done')
    const vatLines = document.querySelectorAll('.vat-line')



    vatLines.forEach((line) => {
      line.innerHTML = "Inc VAT"
    })

    prices.forEach((price) => {
      let incVat = parseInt(price.getAttribute('data-price'))
      let excludeVat = (incVat / 100).toFixed(2)
      price.innerHTML = "£" + excludeVat      
    })
  }

  function removeAllVatFromPrices(){
    const prices = document.querySelectorAll('.price-vat-done')
    const vatLines = document.querySelectorAll('.vat-line')


    removeVatBtn.innerHTML = "Include VAT"

    vatLines.forEach((line) => {
      line.innerHTML = "Excl VAT"
    })

    prices.forEach((price) => {
      let incVat = parseInt(price.getAttribute('data-price'))
      let excludeVat = ((incVat / 1.20)/100).toFixed(2)
      price.innerHTML = "£" + excludeVat      
    })
  }



  fetch(url).then(function (response) {
    return response.json();
  }).then(function (data) {
    if (data.country_code == "GB") {
      document.querySelector('body').classList.add('in-uk')
      let removeVat = localStorage.getItem('removeVat');
      if (removeVat == "true") {
        removeAllVatFromPrices()

      }else{

        showVAT()
      }
    }else{
      localStorage.setItem('removeVat', "false");
      document.querySelector('body').classList.remove('in-uk')
    }
    select.value = data.country_code
  }).catch(function (err) {
    console.warn('Something went wrong.', err);
  });


  select.addEventListener('change', () => {
    if (select.value == "GB") {
      document.querySelector('body').classList.add('in-uk')

      let removeVat = localStorage.getItem('removeVat');
      if (removeVat == "true") {
        removeAllVatFromPrices()
      }else{
        showVAT()
      }

    }else{
      document.querySelector('body').classList.remove('in-uk')
      showVAT()
    }
  })

  removeVatBtn.addEventListener('click', () => {
    let selected = removeVatBtn.getAttribute('data-remove')

    if (selected == "false") {
      removeVatBtn.innerHTML = "Inc VAT"
      removeVatBtn.setAttribute('data-remove', "true")
      localStorage.setItem('removeVat', "true");
      removeAllVatFromPrices()

    }else{
      removeVatBtn.innerHTML = "Remove VAT"
      removeVatBtn.setAttribute('data-remove', "false")
      localStorage.setItem('removeVat', "false");
      showVAT()
    }
  })  

  //close modal
  popupTrigger.addEventListener('click', () => {
    taxPopup.classList.add('active')
    document.querySelector('body').addEventListener('click', (e) => {
      if (taxPopup.contains(e.target) || popupTrigger.contains(e.target)) {
    
      }else{
        taxPopup.classList.remove('active')
      }
    })
  })

  countryButton.addEventListener('click', () => {
    modalCountry.classList.add('active')
  })

  closeButtonCountry.addEventListener('click', () => {
    modalCountry.classList.remove('active')
  })

  document.querySelector('.js-select-country').addEventListener('click', () => {
    modalCountry.classList.remove('active')
  })

</script>